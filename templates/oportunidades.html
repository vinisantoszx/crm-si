{% extends "base.html" %}
{% block content %}

<div class="mb-4">
    <h2 class="page-title">Pipeline de Oportunidades</h2>
    <p class="text-muted">Arraste os cartões para mudar o status (Simulado com botões)</p>
</div>

<div class="kanban-container">

    {% macro render_column(title, status_key, status_db) %}
    <div class="kanban-col">
        <div class="kanban-header">
            <div>
                <h6 class="text-dark">{{ title }}</h6>
                <small class="text-muted">R$ {{ resumo[status_db] }}</small>
            </div>
            <span class="kanban-badge">{{ contagem[status_db] }}</span>
        </div>

        {% for client in clients if client.status == status_db %}
        <div class="kanban-card">
            <small class="text-muted d-block mb-1">Projeto Indefinido</small>
            <div class="fw-bold mb-2">{{ client.name }}</div>
            <div class="h5 text-primary fw-bold mb-3">R$ {{ client.value }}</div>
            
            <div class="d-flex justify-content-between border-top pt-2 mt-2">
                <div class="dropdown">
                    <button class="btn btn-sm btn-light dropdown-toggle" type="button" data-bs-toggle="dropdown">
                        Mover
                    </button>
                    <ul class="dropdown-menu">
                        <li><a class="dropdown-item" href="{{ url_for('update_status', id=client.id, new_status='Lead') }}">Lead</a></li>
                        <li><a class="dropdown-item" href="{{ url_for('update_status', id=client.id, new_status='Qualificado') }}">Qualificado</a></li>
                        <li><a class="dropdown-item" href="{{ url_for('update_status', id=client.id, new_status='Proposta') }}">Proposta</a></li>
                        <li><a class="dropdown-item" href="{{ url_for('update_status', id=client.id, new_status='Negociacao') }}">Negociação</a></li>
                        <li><a class="dropdown-item" href="{{ url_for('update_status', id=client.id, new_status='Fechado') }}">Fechado</a></li>
                    </ul>
                </div>
            </div>
        </div>
        {% endfor %}
    </div>
    {% endmacro %}

    {{ render_column('Leads', 'Lead', 'Lead') }}
    {{ render_column('Qualificados', 'Qualificado', 'Qualificado') }}
    {{ render_column('Proposta', 'Proposta', 'Proposta') }}
    {{ render_column('Negociação', 'Negociacao', 'Negociacao') }}
    {{ render_column('Fechado', 'Fechado', 'Fechado') }}

</div>

{% endblock %}