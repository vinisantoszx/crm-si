{% extends "base.html" %}
{% block content %}

<div class="d-flex justify-content-between align-items-center mb-4">
    <div>
        <h2 class="fw-bold m-0 text-dark">Dashboard</h2>
        <p class="text-muted m-0">Visão geral das suas vendas</p>
    </div>
    <div class="btn-group bg-white shadow-sm rounded p-1" role="group">
        <button type="button" class="btn btn-sm btn-dark rounded">Tudo</button>
        <button type="button" class="btn btn-sm btn-light text-muted">Semana</button>
        <button type="button" class="btn btn-sm btn-light text-muted">Mês</button>
    </div>
</div>

<div class="row g-4">
    <div class="col-md-3">
        <div class="kpi-card">
            <div class="kpi-title">Em Negociação</div>
            <div class="kpi-value">R$ {{ total_volume }}</div>
            <div class="text-muted small">{{ count_active }} oportunidades</div>
            <div class="kpi-icon-box icon-blue">
                <i class="ph-bold ph-trend-up"></i>
            </div>
        </div>
    </div>

    <div class="col-md-3">
        <div class="kpi-card">
            <div class="kpi-title">Vendas Fechadas</div>
            <div class="kpi-value">R$ {{ total_fechado }}</div>
            <div class="text-muted small">Sucesso total</div>
            <div class="kpi-icon-box icon-green">
                <i class="ph-bold ph-currency-dollar"></i>
            </div>
        </div>
    </div>

    <div class="col-md-3">
        <div class="kpi-card">
            <div class="kpi-title">Taxa de Conversão</div>
            <div class="kpi-value">12%</div>
            <div class="text-muted small">Lead &rarr; Venda</div>
            <div class="kpi-icon-box icon-orange">
                <i class="ph-bold ph-target"></i>
            </div>
        </div>
    </div>

    <div class="col-md-3">
        <div class="kpi-card">
            <div class="kpi-title">Ticket Médio</div>
            <div class="kpi-value">R$ 0</div>
            <div class="text-muted small">Por venda fechada</div>
            <div class="kpi-icon-box icon-purple">
                <i class="ph-bold ph-users"></i>
            </div>
        </div>
    </div>
</div>

<div class="row">
    
    <div class="col-md-7">
        <div class="section-card h-100">
            <h5 class="section-title">Pipeline de Vendas</h5>
            
            <div class="mb-4">
                <div class="d-flex justify-content-between mb-1">
                    <span class="fw-medium">Leads</span>
                    <span class="fw-bold">R$ {{ total_volume }}</span>
                </div>
                <div class="progress" style="height: 8px;">
                    <div class="progress-bar bg-primary" role="progressbar" style="width: 40%"></div>
                </div>
            </div>

            <div class="mb-4">
                <div class="d-flex justify-content-between mb-1">
                    <span class="fw-medium">Negociação</span>
                    <span class="fw-bold">R$ {{ total_volume }}</span>
                </div>
                <div class="progress" style="height: 8px;">
                    <div class="progress-bar bg-warning" role="progressbar" style="width: 25%"></div>
                </div>
            </div>

            <div class="mb-4">
                <div class="d-flex justify-content-between mb-1">
                    <span class="fw-medium">Fechados</span>
                    <span class="fw-bold text-success">R$ {{ total_fechado }}</span>
                </div>
                <div class="progress" style="height: 8px;">
                    <div class="progress-bar bg-success" role="progressbar" style="width: 100%"></div>
                </div>
            </div>
            
            <div class="mt-4 pt-3 border-top">
                <h6 class="text-muted mb-3">Acesso Rápido aos Clientes</h6>
                <div class="d-flex gap-2 overflow-auto pb-2">
                    {% for client in clients %}
                    <div class="card p-2 shadow-sm border-0" style="min-width: 150px; background: #f8fafc;">
                        <small class="fw-bold d-block text-truncate">{{ client.name }}</small>
                        <span class="badge bg-white text-dark border">{{ client.status }}</span>
                        <div class="mt-2 text-end">
                            <a href="{{ url_for('update_status', id=client.id, new_status='Fechado') }}" class="btn btn-xs btn-success py-0" style="font-size: 10px;">✔</a>
                        </div>
                    </div>
                    {% endfor %}
                </div>
            </div>
        </div>
    </div>

    <div class="col-md-5">
        <div class="section-card h-100">
            <h5 class="section-title">Últimas Atividades</h5>
            
            {% for client in clients[-5:]|reverse %} <div class="activity-item">
                <div>
                    <div class="fw-bold text-dark">{{ client.name }}</div>
                    <div class="text-muted small">
                        Status: <span class="text-primary">{{ client.status }}</span> • Whatsapp
                    </div>
                </div>
                <div class="fw-bold text-dark">R$ {{ client.value }}</div>
            </div>
            {% else %}
            <p class="text-muted text-center py-4">Nenhuma atividade recente.</p>
            {% endfor %}
            
        </div>
    </div>
</div>

{% endblock %}